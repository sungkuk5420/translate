function changeDBText(t,a,e){var n="",i="",o="",r="";if(void 0===e||""===e){var d=getTextData(t,"ja");e=d.data,n=d.lang}"ko"===n?(i=a,o=e.data.ja):"ja"===n&&(o=a,i=e.data.ko),r=e.data.sendText===t?"ko"===BASELANG?a:"ja"===BASELANG?a:e.data.sendText:e.data.sendText,DATABASE.ref(defaultPath).child("/"+e.id).set({sendText:r,ja:o,ko:i}),$("#txtArea").val(""),$(".changeTextObj").text(a),$("#mypopup").removeClass("show")}function textTranslate(t){function a(n){void 0!==n[0]&&p(n[0]).then(function(i){var o="ko"==t.resultLang?i.ko:i.ja;t.cb&&t.cb(i),$("[data-langtext]").each(function(){var t=$(this);$.trim(t.text())===n[0]&&t.text(o)}),n=e(n,n[0]),BASELANG="ko"===t.resultLang?"ja":"ko",a(n)},function(t){})}function e(t,a){for(var e=t.length;e--;)t[e]&&t[e]===a&&t.splice(e,1);return t}function n(t,a){if(void 0!==t&&""!==t){if("ko"==a){if(""==t.data.ko)return!0}else if("ja"==a&&""==t.data.ja)return!0;return!1}return!0}var i=BASELANG,o="ko"===t.resultLang?"ko":"ja",r=!0===t.checkKey,d=!0===t.autoKey;"ko"==o&&(i="ja",o="ko");var p=function(t){return new Promise(function(a,e){function p(a,e,n){if("ja"==e){l=a;i=1==r?"":t}else if("ko"==e){var i=a;l=1==r?"":t}s(t,i,l,u)}function s(t,e,n,i){if(void 0!==i&&""!==i){var o="";return""!==n?o=i.data.ko:""!==e&&(o=i.data.ja),changeDBText("",o,i),!1}DATABASE.ref(defaultPath).child("/").push({sendText:t,ja:n,ko:e},function(i){i||a({sendText:t,ja:n,ko:e})})}var u=getTextData(t,o).data;if(n(u,o)){var l="";translateAPI(t,i,o,function(a){var e=a.translatedText;a.srcLangType;if(t==e&&1==d)return n(getTextData(t,i).data,o)&&translateAPI(t,o,i,function(t){p(t.translatedText,o)}),!1;p(e,o)})}else a(u.data)})};if(t.sendText)p(t.sendText).then(function(a){t.cb&&t.cb(a),BASELANG="ko"===t.resultLang?"ja":"ko"},function(t){});else if(void 0===t.sendText){var s=[];$("[data-langtext]").each(function(){var t=$(this),a=$.trim(t.text());s.push(a)}),a(s)}}function translateAPI(t,a,e,n){$.ajax({type:"GET",beforeSend:function(t){t.setRequestHeader("content-type","text/javascript")},url:"/translate",data:{text:t,sendLang:a,resultLang:e},dataType:"json",contentType:"application/json; charset=utf-8",success:function(t){var t=JSON.parse(t);n&&n(t.message.result)}})}function getTextData(t,a){var e=[],n="";return"ko"==a?(e=DBData.filter(function(a){return a.data.ja===t}),n="ja"):"ja"==a&&(e=DBData.filter(function(a){return a.data.ko===t}),n="ko"),0!==e.length?{data:e[0],lang:n}:(e=DBData.filter(function(a){return(void 0!==a.data.sendText?$.trim(a.data.sendText):void 0)===t}),n="sendText","ko"==a?(e=DBData.filter(function(a){return(void 0!==a.data.ko?$.trim(a.data.ko):void 0)===t}),n="ko"):"ja"==a&&(e=DBData.filter(function(a){return(void 0!==a.data.ja?$.trim(a.data.ja):void 0)===t}),n="ja"),0!==e.length&&("ko"==a&&""===e[0].data.ko||"ja"==a&&""===e[0].data.ja)&&(e=[]),1===e.length?{data:e[0],lang:n}:{data:"",lang:""})}function translateInit(t){getDataBase("cbTrue").then(function(a){addClickCss(),addPopupHTML(),t&&t()},function(t){})}function addClickCss(){var t="<style type='text/css'> ";t+=".langClickCss:hover{ background-color:#ddd; font-weight:bold; curser: pointer;}",t+=" </style>",$("head").append(t),$("[data-langtext]").addClass("langClickCss"),$(".langClickCss").click(function(){$(this).addClass("changeTextObj");var t=getTextData($.trim($(this).text()),BASELANG);""===t.data&&""===t.lang||popupOpen($(this).text())})}function addPopupHTML(){var t="<style type='text/css'> ",a="<style type='text/css'> ";t+=".popup-ui { position: fixed; width: 100%; height: 100%; top: 0; left: 0; z-index: 7777; opacity: 0; visibility: hidden; background: rgba(0, 0, 0, 0.5); text-align: center; transition: all 0.2s ease-in-out; }",t+=".popup-ui:before { content: ''; display: inline-block; height: 100%; vertical-align: middle; }",t+=".popup-ui .popup-ui-wrapper { position: relative; display: inline-block; vertical-align: middle; margin: 0 auto; text-align: left; max-width:90%; }",t+=".popup-ui .popup-ui-wrapper .popup-ui-content { position: relative; background: #FFF; padding: 0; width: auto; margin: 0 auto; opacity: 0; visibility: hidden; border: solid 5px #FFF; width:100%; transition: all 0.2s ease-in-out; transform: scale(0.8); box-shadow: 0 0 5px 2px rgba(0, 0, 0, 0.5); }",t+=".popup-ui.show { opacity: 1; visibility: visible; }",t+=".popup-ui.show .popup-ui-content { opacity: 1; visibility: visible; transform: scale(1); }",t+=".my-content img { max-width: 100%; height: auto; }",t+=".my-content h3 { padding: 0 10px; font-weight: 300; margin-bottom: 0; }",t+=".my-content p { padding: 0 10px; font-size: 0.9em; }",t+="#btnpopup { display: block; margin: 2em auto 0 auto; width: 200px; }",t+=" </style>",a="<style type='text/css'> ",a+=" #txtArea { width: 100%; margin-top: 10px; padding: 10px;}",a+=" </style>",$("body").append('<div id="mypopup" class="popup-ui"><div class="popup-ui-wrapper"><div class="popup-ui-content"><div class="my-content"><h3 class="textString"></h3><textarea  id="txtArea" rows="4" onkeypress="enterKeyEvent();" ></textarea></div></div></div></div>'),$("head").append(t),$("head").append(a);document.getElementById("btnpopup");document.getElementById("mypopup").addEventListener("click",function(){0==$(event.target).closest(".popup-ui-wrapper").length&&(this.className="popup-ui",$(".changeTextObj").removeClass("changeTextObj"))},!1)}function popupOpen(t){document.getElementById("mypopup").className="popup-ui  show",$("#mypopup").find(".textString").text(t),$("#mypopup").find(".inputForm").attr("placeholder",t)}function enterKeyEvent(){if(13===window.event.keyCode)return event.shiftKey||(changeDBText($.trim($(".textString").text()),$.trim($("#txtArea").val())),event.preventDefault()),!1}var DBData=void 0;firebase.initializeApp(config);var BASELANG="ko",DATABASE=void 0,defaultPath="/translate",getDataBase=function(t){return new Promise(function(a,e){(DATABASE=firebase.database()).ref(defaultPath).on("value",function(e){var n=e.val();DBData=Object.keys(n).map(function(t){return{id:t,data:n[t]}}),t&&a(DBData)})})};
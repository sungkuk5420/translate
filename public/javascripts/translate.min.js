function changeDBText(originalText,changeText,translateTextObj){var findLang="",koText="",jaText="",sendText="";if(void 0===translateTextObj||""===translateTextObj){var data=getTextData(originalText,"ja");translateTextObj=data.data,findLang=data.lang}"ko"===findLang?(koText=changeText,jaText=translateTextObj.data.ja):"ja"===findLang&&(jaText=changeText,koText=translateTextObj.data.ko),sendText=translateTextObj.data.sendText===originalText?"ko"===BASELANG?changeText:"ja"===BASELANG?changeText:translateTextObj.data.sendText:translateTextObj.data.sendText,DATABASE.ref(defaultPath).child("/"+translateTextObj.id).set({sendText:sendText,ja:jaText,ko:koText}),$("#txtArea").val(""),$(".changeTextObj").text(changeText),$("#mypopup").removeClass("show")}function textTranslate(parmas){function recursiveFuc(textArr){void 0!==textArr[0]&&promiseFunc(textArr[0]).then(function(translateTextObj){console.log(translateTextObj);var translateText="ko"==parmas.resultLang?translateTextObj.ko:translateTextObj.ja;parmas.cb&&parmas.cb(translateTextObj),$("[data-langtext]").each(function(){var $this=$(this),thisText=$.trim($this.text());thisText===textArr[0]&&$this.text(translateText)}),textArr=removeArray(textArr,textArr[0]),BASELANG="ko"===parmas.resultLang?"ja":"ko",recursiveFuc(textArr)},function(error){console.error(error)})}function removeArray(arr,value){for(var i=arr.length;i--;)arr[i]&&arr[i]===value&&arr.splice(i,1);return arr}function canTranslateApi(translateTextObj,resultLang){if(void 0!==translateTextObj&&""!==translateTextObj){if("ko"==resultLang){if(""==translateTextObj.data.ko)return!0}else if("ja"==resultLang&&""==translateTextObj.data.ja)return!0;return!1}return!0}var sendLang=BASELANG,resultLang="ko"===parmas.resultLang?"ko":"ja",checkKey=parmas.checkKey===!0?!0:!1,autoKey=parmas.autoKey===!0?!0:!1;"ko"==resultLang&&(sendLang="ja",resultLang="ko");var promiseFunc=function(sendText){return console.log(sendText),new Promise(function(resolve,reject){function translateCB(translatedText,resultLang,cb){if("ja"==resultLang){jaText=translatedText;var koText=1==checkKey?"":sendText}else if("ko"==resultLang){var koText=translatedText;jaText=1==checkKey?"":sendText}pushData(sendText,koText,jaText,translateTextObj)}function pushData(sendText,koText,jaText,translateTextObj){if(void 0!==translateTextObj&&""!==translateTextObj){console.log(translateTextObj);var originalText="",changeText="";return""!==jaText?changeText=translateTextObj.data.ko:""!==koText&&(changeText=translateTextObj.data.ja),changeDBText(originalText,changeText,translateTextObj),!1}DATABASE.ref(defaultPath).child("/").push({sendText:sendText,ja:jaText,ko:koText},function(error){error?console.log("Error has occured during saving process"):(console.log("Data hss been saved succesfully"),resolve({sendText:sendText,ja:jaText,ko:koText}))})}console.log(sendText);var translateTextObj=getTextData(sendText,resultLang).data,bl=canTranslateApi(translateTextObj,resultLang);if(bl){var jaText="";translateAPI(sendText,sendLang,resultLang,function(data){var translatedText=data.translatedText;data.srcLangType;return sendText==translatedText&&1==autoKey?(canTranslateApi(getTextData(sendText,sendLang).data,resultLang)&&translateAPI(sendText,resultLang,sendLang,function(data){var translatedText=data.translatedText;translateCB(translatedText,resultLang)}),!1):void translateCB(translatedText,resultLang)})}else console.log("이미 단어가 있습니다 : koText : "+translateTextObj.data.ko+" jaText :"+translateTextObj.data.ja),resolve(translateTextObj.data)})};if(parmas.sendText)promiseFunc(parmas.sendText).then(function(translateTextObj){console.log(translateTextObj),parmas.cb&&parmas.cb(translateTextObj),BASELANG="ko"===parmas.resultLang?"ja":"ko"},function(error){console.error(error)});else if(void 0===parmas.sendText){var textArr=[];$("[data-langtext]").each(function(){var $this=$(this),thisText=$.trim($this.text());textArr.push(thisText)}),recursiveFuc(textArr)}}function translateAPI(sendText,sendLang,resultLang,cb){console.log(sendText,sendLang,resultLang,cb);var apiUrl="";$.ajax({type:"GET",beforeSend:function(request){request.setRequestHeader("content-type","text/javascript")},url:apiUrl+"/translate",data:{text:sendText,sendLang:sendLang,resultLang:resultLang},dataType:"json",contentType:"application/json; charset=utf-8",success:function(data){var data=JSON.parse(data);cb&&cb(data.message.result)}})}function getTextData(sendText,resultLang){var textData=[],findLang="";return"ko"==resultLang?(textData=DBData.filter(function(item){return item.data.ja===sendText}),findLang="ja"):"ja"==resultLang&&(textData=DBData.filter(function(item){return item.data.ko===sendText}),findLang="ko"),0!==textData.length?{data:textData[0],lang:findLang}:(textData=DBData.filter(function(item){var itemText=void 0!==item.data.sendText?$.trim(item.data.sendText):void 0;return itemText===sendText}),findLang="sendText","ko"==resultLang?(textData=DBData.filter(function(item){var itemText=void 0!==item.data.ko?$.trim(item.data.ko):void 0;return itemText===sendText}),findLang="ko"):"ja"==resultLang&&(textData=DBData.filter(function(item){var itemText=void 0!==item.data.ja?$.trim(item.data.ja):void 0;return itemText===sendText}),findLang="ja"),0!==textData.length&&("ko"==resultLang&&""===textData[0].data.ko||"ja"==resultLang&&""===textData[0].data.ja)&&(textData=[]),1===textData.length?{data:textData[0],lang:findLang}:{data:"",lang:""})}function translateInit(cb){getDataBase("cbTrue").then(function(DBData){console.log(DBData),cb&&cb()},function(error){console.error(error)})}function addClickCss(){var cssHTML="<style type='text/css'> ";cssHTML+=".langClickCss:hover{ background-color:#ddd; font-weight:bold; curser: pointer;}",cssHTML+=" </style>",$("head").append(cssHTML),$("[data-langtext]").addClass("langClickCss"),$(".langClickCss").click(function(){$(this).addClass("changeTextObj");var data=getTextData($.trim($(this).text()),BASELANG);console.log(data),""===data.data&&""===data.lang?alert("DB에 데이터가 없습니다."):popupOpen($(this).text())})}function addPopupHTML(){var popupHTML='<div id="mypopup" class="popup-ui"><div class="popup-ui-wrapper"><div class="popup-ui-content"><div class="my-content"><h3 class="textString"></h3><textarea  id="txtArea" rows="4" onkeypress="enterKeyEvent();" ></textarea></div></div></div></div>',cssHTML="<style type='text/css'> ",inputCssHTML="<style type='text/css'> ";cssHTML+=".popup-ui { position: fixed; width: 100%; height: 100%; top: 0; left: 0; z-index: 7777; opacity: 0; visibility: hidden; background: rgba(0, 0, 0, 0.5); text-align: center; transition: all 0.2s ease-in-out; }",cssHTML+=".popup-ui:before { content: ''; display: inline-block; height: 100%; vertical-align: middle; }",cssHTML+=".popup-ui .popup-ui-wrapper { position: relative; display: inline-block; vertical-align: middle; margin: 0 auto; text-align: left; max-width:90%; }",cssHTML+=".popup-ui .popup-ui-wrapper .popup-ui-content { position: relative; background: #FFF; padding: 0; width: auto; margin: 0 auto; opacity: 0; visibility: hidden; border: solid 5px #FFF; width:100%; transition: all 0.2s ease-in-out; transform: scale(0.8); box-shadow: 0 0 5px 2px rgba(0, 0, 0, 0.5); }",cssHTML+=".popup-ui.show { opacity: 1; visibility: visible; }",cssHTML+=".popup-ui.show .popup-ui-content { opacity: 1; visibility: visible; transform: scale(1); }",cssHTML+=".my-content img { max-width: 100%; height: auto; }",cssHTML+=".my-content h3 { padding: 0 10px; font-weight: 300; margin-bottom: 0; }",cssHTML+=".my-content p { padding: 0 10px; font-size: 0.9em; }",cssHTML+="#btnpopup { display: block; margin: 2em auto 0 auto; width: 200px; }",cssHTML+=" </style>",inputCssHTML="<style type='text/css'> ",inputCssHTML+=" #txtArea { width: 100%; margin-top: 10px; padding: 10px;}",inputCssHTML+=" </style>",$("body").append(popupHTML),$("head").append(cssHTML),$("head").append(inputCssHTML);var POPUP=(document.getElementById("btnpopup"),document.getElementById("mypopup"));POPUP.addEventListener("click",function(){0==$(event.target).closest(".popup-ui-wrapper").length&&(this.className="popup-ui",$(".changeTextObj").removeClass("changeTextObj"))},!1)}function popupOpen(textString){var POPUP=document.getElementById("mypopup");POPUP.className="popup-ui  show",$("#mypopup").find(".textString").text(textString),$("#mypopup").find(".inputForm").attr("placeholder",textString)}function enterKeyEvent(){var key=window.event.keyCode;return 13===key?(event.shiftKey||(changeDBText($.trim($(".textString").text()),$.trim($("#txtArea").val())),event.preventDefault()),!1):void 0}var DBData=void 0;firebase.initializeApp(config);var BASELANG="ko",DATABASE=void 0,defaultPath="/",getDataBase=function(cb){return new Promise(function(resolve,reject){DATABASE=firebase.database(),DATABASE.ref(defaultPath).on("value",function(data){var database=data.val();DBData=Object.keys(database).map(function(data){return{id:data,data:database[data]}}),cb&&resolve(DBData)})})};